<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VN FOOD - General Store</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>

<header class="hero">
    <img src="https://i.imgur.com/GJHq5nY.png" class="logo">
    <h1>VN FOOD</h1>
    <p class="subtitle">Your Trusted General Store</p>
</header>

<!-- STICKY HIGHLIGHT + SEARCH ICON -->
<div id="stickyHighlight" class="sticky-highlight">
    <div class="slider" id="highlightSlider">

        <!-- SEARCH ICON INSIDE SLIDER -->
        <div class="highlight-box search-icon-box" onclick="toggleSearch()">
            <div class="search-icon">üîç</div>
        </div>

    </div>
</div>

<!-- SEARCH PANEL EXPANDABLE -->
<div id="searchPanel" class="search-panel">
    <button class="close-btn" onclick="toggleSearch()">‚ùÆ</button>

    <input type="text" id="searchInput" placeholder="Search items..." onkeyup="applyFilters()">

    <select id="categoryFilter" onchange="applyFilters()">
        <option value="all">All Categories</option>
    </select>
</div>

<h2 class="section-title">‚≠ê Highlight Items ‚≠ê</h2>

<!-- PRODUCT LIST -->
<div class="grid-container">
    <div class="grid" id="productGrid"></div>
</div>

<script>
/* ==============================
   CSV LINKS
   ============================== */
const SHEET_PRODUCTS =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTTCtV7qFSDZDCVIDI2vkXzGxI5GbG8Ez8suIyx_TrDEXSS6t23s6QrFn9ttW079TZk6yenfuc5LVt1/pub?gid=0&single=true&output=csv";

const SHEET_HIGHLIGHT =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTTCtV7qFSDZDCVIDI2vkXzGxI5GbG8Ez8suIyx_TrDEXSS6t23s6QrFn9ttW079TZk6yenfuc5LVt1/pub?gid=2032194924&single=true&output=csv";

let allProducts = [];

/* ==============================
   LOAD HIGHLIGHT ITEMS
   ============================== */
Papa.parse(SHEET_HIGHLIGHT, {
    download: true,
    header: true,
    complete: res => {
        const slider = document.getElementById("highlightSlider");

        res.data.forEach(item => {
            if (!item.name) return;
            slider.innerHTML += `
                <div class="highlight-box">
                    <img src="${item.img_url}?v=${Date.now()}">
                    <div class="highlight-name">${item.name}</div>
                    <div class="highlight-price">${item.price}</div>
                </div>`;
        });
    }
});

/* ==============================
   LOAD PRODUCTS
   ============================== */
Papa.parse(SHEET_PRODUCTS, {
    download: true,
    header: true,
    complete: res => {
        allProducts = res.data.filter(i => i.name);
        generateCategoryFilter(allProducts);
        renderProducts(allProducts);
    }
});

/* CATEGORY FILTER BUILDER */
function generateCategoryFilter(items) {
    const select = document.getElementById("categoryFilter");
    let categories = ["all"];

    items.forEach(p => {
        if (p.category && !categories.includes(p.category))
            categories.push(p.category);
    });

    categories.forEach(cat => {
        select.innerHTML += `<option value="${cat}">${cat}</option>`;
    });
}

/* RENDER PRODUCTS */
function renderProducts(list) {
    const grid = document.getElementById("productGrid");
    grid.innerHTML = "";

    list.forEach(item => {
        grid.innerHTML += `
            <div class="item" data-category="${item.category.toLowerCase()}">
                <img src="${item.img_url}?v=${Date.now()}">
                <div class="name">${item.name}</div>
                <div class="price">${item.price}</div>
            </div>`;
    });
}

/* SEARCH + CATEGORY FILTER */
function applyFilters() {
    let search = document.getElementById("searchInput").value.toLowerCase().trim();
    let category = document.getElementById("categoryFilter").value.toLowerCase();
    let words = search.split(" ").filter(w => w.length > 0);

    let filtered = allProducts.filter(item => {
        let name = item.name.toLowerCase();
        let catMatch = (category === "all" || item.category.toLowerCase() === category);
        let textMatch = words.every(w => name.includes(w));
        return catMatch && textMatch;
    });

    renderProducts(filtered);
}

/* ==============================
   SEARCH PANEL TOGGLE
   ============================== */
function toggleSearch() {
    const panel = document.getElementById("searchPanel");
    panel.classList.toggle("open");
}

/* ==============================
   COMPACT MODE ON SCROLL
   ============================== */
const sticky = document.getElementById("stickyHighlight");
let last = 0;

window.addEventListener("scroll", () => {
    let y = window.scrollY;

    if (y > last + 10) {
        sticky.classList.add("compact");
    } else if (y < last - 10) {
        sticky.classList.remove("compact");
    }

    last = y;
});

/* ==============================
   DRAGGABLE HIGHLIGHT SLIDER
   ============================== */
const slider = document.querySelector('.slider');
let isDown = false;
let startX;
let scrollLeft;

slider.addEventListener('mousedown', (e) => {
    isDown = true;
    startX = e.pageX - slider.offsetLeft;
    scrollLeft = slider.scrollLeft;
});
slider.addEventListener('mouseleave', () => isDown = false);
slider.addEventListener('mouseup', () => isDown = false);

slider.addEventListener('mousemove', (e) => {
    if (!isDown) return;
    const x = e.pageX - slider.offsetLeft;
    const walk = (x - startX) * 1;
    slider.scrollLeft = scrollLeft - walk;
});

slider.addEventListener('touchstart', (e) => {
    startX = e.touches[0].pageX - slider.offsetLeft;
    scrollLeft = slider.scrollLeft;
}, { passive: true });

slider.addEventListener('touchmove', (e) => {
    const x = e.touches[0].pageX - slider.offsetLeft;
    const walk = (x - startX) * 1;
    slider.scrollLeft = scrollLeft - walk;
}, { passive: true });

</script>

</body>
</html>
